import{d as U,r,R as z,S as B,T as y,o as L,U as R,a as _,b as f,f as l,z as I,F as T,i as w,e as s,t as m,h as F,m as p,_ as S}from"./index-CH_Ckgnz.js";const j={key:0},D={class:"item"},M={class:"title"},O=["poster","data-src"],$=["onClick"],q={class:"user"},A={class:"userInfo"},G=["src"],H={class:"icon"},J={class:"iconItem"},K={class:"iconItem"},Q={class:"iconItem"},W=U({__name:"VideoView",setup(X){const a=r([]),h=r(0);z().then(e=>{a.value=e.data.data.feeds.map(t=>({...t,isPlaying:!1}))});const b=r(0),u=r(!1),k=r(!1),x=()=>{u.value=!0,z(h.value).then(e=>{a.value&&(a.value=[...a.value,...e.data.data.feeds],u.value=!1,h.value=h.value+10,a.value.length>=100&&(k.value=!0))})},i=B("videos");console.log(i);const C=new IntersectionObserver(e=>{e.forEach(t=>{const n=t.target,c=a.value.findIndex(g=>{var d;return((d=g.video)==null?void 0:d.url)===n.dataset.src});c!==-1&&(t.isIntersecting?(n.src=n.dataset.src,n.play(),y(()=>{a.value[c].isPlaying=!0})):(n.pause(),a.value[c].isPlaying=!1))})},{threshold:1});L(()=>{y(()=>{setTimeout(()=>{var e;(e=i.value)==null||e.forEach(t=>{C.observe(t)})},1e3)})}),R(()=>{y(()=>{setTimeout(()=>{var e;(e=i.value)==null||e.forEach(t=>{C.unobserve(t)})},1e3)})});const E=e=>{a.value[e].isPlaying?i.value[e].pause():i.value[e].play(),a.value[e].isPlaying=!a.value[e].isPlaying};return(e,t)=>{const n=p("van-icon"),c=p("van-list"),g=p("van-tab"),d=p("van-tabs");return a.value?(_(),f("div",j,[l(d,{active:b.value,"onUpdate:active":t[1]||(t[1]=v=>b.value=v),animated:""},{default:I(()=>[(_(),f(T,null,w(["推荐","热片解读","新品预告"],v=>l(g,{title:v,key:v},{default:I(()=>[l(c,{loading:u.value,"onUpdate:loading":t[0]||(t[0]=o=>u.value=o),finished:k.value,"finished-text":"没有更多了",onLoad:x},{default:I(()=>[(_(!0),f(T,null,w(a.value,(o,N)=>{var P,V;return _(),f("div",{key:o.id,class:"video"},[s("div",D,[s("p",M,m(o.title),1),s("video",{controls:"",class:"video-player",ref_for:!0,ref:"videos",poster:(P=o.images[0])==null?void 0:P.url,muted:"","data-src":(V=o.video)==null?void 0:V.url},null,8,O),s("div",{class:"playIcon",onClick:Y=>E(N)},[l(n,{name:o.isPlaying?"":"play-circle-o",size:"60",color:"#fff"},null,8,["name"])],8,$)]),s("div",q,[s("div",A,[s("img",{src:o.user.avatarurl,alt:""},null,8,G),s("span",null,m(o.user.nickName),1)]),s("div",H,[s("div",J,[l(n,{name:"good-job-o",size:"20",color:"#777"}),s("span",null,m(o.upCount),1)]),s("div",K,[l(n,{name:"chat-o",size:"20",color:"#777"}),s("span",null,m(o.commentCount),1)]),s("div",Q,[l(n,{name:"share-o",size:"20",color:"#777"})])])])])}),128))]),_:1},8,["loading","finished"])]),_:2},1032,["title"])),64))]),_:1},8,["active"])])):F("",!0)}}}),ee=S(W,[["__scopeId","data-v-70cfe2cd"]]);export{ee as default};
