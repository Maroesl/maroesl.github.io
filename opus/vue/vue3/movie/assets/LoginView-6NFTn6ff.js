import{E as P,G as R,H as E,I as K,J as G,f as c,K as H,L as Q,d as W,M as X,r as d,N as Y,a as y,b as k,e as t,p as Z,O as ee,P as te,h as I,F as se,t as C,z as oe,u as ne,l as M,Q as l,m as p,_ as ae}from"./index-CUj4cCHW.js";let $,m;const le=s=>E(s)?s:{message:s};function re(){({instance:m}=K({setup(){const{state:s,toggle:f}=G();return()=>c(Q,H(s,{"onUpdate:show":f}),null)}}))}const ue=()=>({type:"danger",color:void 0,message:"",onClose:void 0,onClick:void 0,onOpened:void 0,duration:3e3,position:void 0,className:"",lockScroll:!1,background:void 0});let ie=ue();const ce=()=>{m&&m.toggle(!1)};function de(s){if(P)return m||re(),s=R({},ie,le(s)),m.open(s),clearTimeout($),s.duration>0&&($=setTimeout(ce,s.duration)),m}const ve={style:{"font-size":"18rem","box-sizing":"border-box"}},pe={class:"phone"},me={key:0,class:"password_input"},fe={class:"word"},ge={class:"chekbox"},he={class:"up_main"},_e={class:"up-num"},ye={class:"toggle"},ke={key:3},we="我已阅读并同意《猫眼用户服务协议》和《隐私政策》并授权猫眼使用该猫眼账号信息（如昵称，头像，收获地址）以便统一管理",xe=W({__name:"LoginView",setup(s){const f=ne(),V=M(),D=X(),{updateOrdersArray:w}=D,J=M(),x=d(!1),z=["《猫眼用户服务协议》","《隐私政策》"],i=d(""),v=d(""),N=d(!1),g=d(!1),b=d(""),U=/^1[3-9]\d{9}$/,T=()=>{g.value=!g.value},B=()=>{N.value=!1,h.value=""},O=o=>{localStorage.setItem("token",JSON.stringify(o)),localStorage.setItem("token2",JSON.stringify(i.value))},F=()=>{if(!x.value){l("请先同意协议");return}if(!U.test(i.value)){l("请输入正确的手机号码");return}if(v.value===""){const o="0123456789";v.value=Array.from({length:6},()=>o.charAt(Math.floor(Math.random()*o.length))).join(""),de({type:"primary",message:`短信验证码已发送,验证码为：${v.value}`,duration:5e3,zIndex:10001}),N.value=!0}else N.value=!0},j=()=>{if(!x.value){l("请先同意协议");return}if(!U.test(i.value)){l("请输入正确的手机号码");return}if(b.value.length<6){l("密码长度不能小于6位");return}const o=JSON.parse(localStorage.getItem("users"))||[],e=o.find(a=>a.tel===i.value);if(e)if(b.value==="123456"){O(e.username),l("登录成功"),w();const a=f.query.target||"/";V.replace(a).catch(r=>{r.name!=="NavigationDuplicated"&&console.error("导航错误：",r)})}else l("密码错误");else{const r={username:`用户${Math.floor(1e3+Math.random()*9e3)}`,gender:"男",tel:i.value};o.push(r),localStorage.setItem("users",JSON.stringify(o)),O(r.username),l("注册并登录成功"),w();const _=f.query.target||"/";V.replace(_).catch(n=>{n.name!=="NavigationDuplicated"&&console.error("导航错误：",n)})}},S=d(!0),h=d("");return Y(h,o=>{if(o.length===6)if(o===v.value){const e=Math.floor(1e3+Math.random()*9e3),a=JSON.parse(localStorage.getItem("users"))||[],r=a.find(n=>n.tel===i.value);if(r)O(r.username),l("登录成功"),w();else{const n={username:`用户${e}`,gender:"男",tel:i.value,wantwatch:[]};a.push(n),localStorage.setItem("users",JSON.stringify(a)),O(n.username),l("注册并登录成功"),w()}const _=f.query.target||"/";V.replace(_).catch(n=>{n.name!=="NavigationDuplicated"&&console.error("导航错误：",n)})}else l("验证码错误")}),(o,e)=>{const a=p("van-icon"),r=p("van-field"),_=p("van-checkbox"),n=p("van-highlight"),q=p("van-password-input"),A=p("van-number-keyboard"),L=p("van-popup");return y(),k("div",ve,[t("header",null,[t("div",{class:"icon",onClick:e[0]||(e[0]=u=>Z(J).back())},[c(a,{name:"cross"})]),e[7]||(e[7]=t("div",{style:{"font-size":"16rem"}},"帮助",-1))]),t("main",null,[e[10]||(e[10]=t("h1",null,"欢迎来到猫眼",-1)),t("div",pe,[ee(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=u=>i.value=u),placeholder:"请输入手机号码"},null,512),[[te,i.value]])]),g.value?(y(),k("div",me,[c(r,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=u=>b.value=u),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])])):I("",!0),e[11]||(e[11]=t("p",{class:"tip"},"未注册的手机号验证后自动创建猫眼账户",-1)),t("div",fe,[t("span",ge,[c(_,{"checked-color":"red","icon-size":"16rem",modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=u=>x.value=u)},null,8,["modelValue"])]),t("span",null,[c(n,{keywords:z,"source-string":we})])]),g.value===!1?(y(),k(se,{key:1},[t("div",{class:"getmess",onClick:F},C(v.value?"继续输入验证码":"获取短信验证码"),1),c(L,{show:N.value,position:"bottom",style:{height:"100%"}},{default:oe(()=>[t("div",he,[t("div",{class:"up-icon",onClick:B},[t("span",null,[c(a,{name:"cross",color:"#999"})])]),e[8]||(e[8]=t("div",{class:"up-text"},[t("h2",null,"请输入你收到的验证码")],-1)),t("div",_e,[c(q,{value:h.value,mask:!1,focused:S.value,onFocus:e[4]||(e[4]=u=>S.value=!0)},null,8,["value","focused"]),c(A,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=u=>h.value=u),show:S.value,onBlur:e[6]||(e[6]=u=>S.value=!1)},null,8,["modelValue","show"])])])]),_:1},8,["show"])],64)):(y(),k("div",{key:2,class:"getmess",onClick:j},"登录")),t("div",ye,[t("span",{onClick:T},C(g.value?"验证码登录":"密码登录"),1),e[9]||(e[9]=t("span",null,"遇到问题",-1))]),v.value?(y(),k("div",ke,"验证码："+C(v.value),1)):I("",!0)])])}}}),be=ae(xe,[["__scopeId","data-v-c7ba3ed3"]]);export{be as default};
